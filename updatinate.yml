cache-path: ${env.HOME}/.config/pantheon-upstream
working-copy-path: ${env.HOME}/pantheon/update-working-copies
log:
  path: ${env.HOME}/.updatinate/pr.log
github:
  default-user: updatinate
  personal-auth-token:
    # This is a read-only token for pantheon-upstream
    pantheon-upstream:
      path: ${cache-path}/github-token
    # This is a read/write token for pantheon-upstream
    updatinate:
      path: ${cache-path}/updatinate-token
    # This is a read-only token for pantheon-circleci
    pantheon-circleci:
      path: ${cache-path}/pantheon-circleci-token
    me:
      path: ${env.HOME}/.github-token
php-net:
  download-url: http://php.net/distributions/php-{version}.tar.gz

projects:
  rpmbuild-php:
    repo: git@github.com:pantheon-systems/rpmbuild-php.git
    path: ${working-copy-path}/rpmbuild-php
  php-cookbook:
    repo: git@github.com:pantheon-systems/infrastructure.git
    path: ${working-copy-path}/infrastructure
    src: pantheon-cookbooks/php/libraries/php.rb
    fork: git@github.com:pantheon-circleci/infrastructure.git
  drops-8:
    repo: git@github.com:pantheon-systems/drops-8.git
    path: ${working-copy-path}/drops-8
    main-branch: default
    upstream:
      project: drupal
      major: 8
      update-method: SingleCommit
      update-parameters:
        platform-additions:
          - .circleci
          - .drush-lock-update
          - .gitignore
          - pantheon.upstream.yml
          - drush/example.drushrc.php
          - sites/default/config/.htaccess
          - sites/default/config/README.txt
          - sites/default/default.services.pantheon.preproduction.yml
          - sites/default/settings.pantheon.php
          - sites/default/settings.php
      update-filters:
        -
          filter: FixupDrupal8
    pr:
      instructions: |
        Update from Drupal {{original-version}} to Drupal {{update-version}}.

        Before merging this PR, check the [build results on CircleCI](https://circleci.com/gh/pantheon-systems/drops-8), and then visit the test site and confirm that the correct version of Drupal was, in fact, installed and tested.

        Optionally, you may also create your own test site:

          - Create a new Drupal 8 site on Pantheon.
          - When site creation is finished, visit dashboard.
          - Switch to "git" mode.
          - Clone your site locally.
          - Apply the files from this PR on top of your local checkout.
            - git remote add {{project}} {{project-url}}
            - git fetch {{project}}
            - git merge {{project}}/{{branch}}
          - Push your files back up to Pantheon.
          - Switch back to sftp mode.
          - Visit your site and step through the installation process.
  drops-7:
    repo: git@github.com:pantheon-systems/drops-7.git
    path: ${working-copy-path}/drops-7
    main-branch: default
    upstream:
      project: pressflow7
      major: 7
      version-pattern: '#.#'
      tag-prefix: 'pressflow-'
      update-message: Update to Drupal {version}.
      update-method: SingleCommit
      update-parameters:
        platform-additions:
          - .circleci
          - .drush-lock-update
          - .gitignore
          - pantheon.upstream.yml
          - misc/healthchecks/
          - profiles/pantheon/
          - modules/pantheon/
        platform-patches:
          - https://raw.githubusercontent.com/pantheon-systems/drops-7/patches/drops-7-pantheon.patch
    pr:
      instructions: |
        Update from Drupal {{original-version}} to Drupal {{update-version}}.

        Before merging this PR, check the [build results on CircleCI](https://circleci.com/gh/pantheon-systems/drops-7), and then visit the test site and confirm that the correct version of Drupal was, in fact, installed and tested.

        Optionally, you may also create your own test site:

          - Create a new Drupal 8 site on Pantheon.
          - When site creation is finished, visit dashboard.
          - Switch to "git" mode.
          - Clone your site locally.
          - Apply the files from this PR on top of your local checkout.
            - git remote add {{project}} {{project-url}}
            - git fetch {{project}}
            - git merge {{project}}/{{branch}}
          - Push your files back up to Pantheon.
          - Switch back to sftp mode.
          - Visit your site and step through the installation process.
  pressflow7:
    repo: git@github.com:pressflow/7.git
    path: ${working-copy-path}/pressflow7
    upstream:
      project: drupal
      major: 7
      version-pattern: '#.#'
      update-method: MergeUpstreamBranch
    release-node:
      template: 'https://www.drupal.org/project/drupal/releases/{version}'
  drupal:
    repo: git://git.drupal.org/project/drupal.git
    path: ${working-copy-path}/drupal
    release-node:
#      url: https://www.drupal.org/project/drupal
#      pattern: '"(https://www.drupal.org/project/drupal/releases/{major}[0-9.]*)"'
      template: 'https://www.drupal.org/project/drupal/releases/{version}'
